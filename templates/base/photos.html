{% load static from staticfiles %}
{% load sekizai_tags %}
{% load canada_filters %}

{% with first_photo=photos|first %}
{% if first_photo %}
<a href="{{ first_photo.safe_thumbnail_image.url }}" title="Click to view photos" class="gallery-{{ id }} zoom-cursor"/>
  <img src="{{ first_photo.safe_thumbnail_image.url }}" height="{{ first_photo.safe_thumbnail_image.height }}" width="{{ first_photo.safe_thumbnail_image.width }}"/>
</a>
{% addtoblock "js" %}
<script type="text/javascript">
  document.write(
    '<script src=' +
    ('__proto__' in {} ? '{% static "canada/scripts/zepto.min.js" %}' : '{% static "canada/bower_components/jquery/jquery.min.js" %}') +
    '><\/script>'
  )
</script>
<script src="{% static "canada/bower_components/magnific-popup/dist/jquery.magnific-popup.min.js" %}"></script>
{% endaddtoblock %}
{% addtoblock "js" %}
<script>
  {% if not id %}
  console.error("The photos template with the first image {{ first_photo.id }} ({{ first_photo.title }}) MUST be passed the id of the owning model.");
  {% endif %}
  $(document).ready(function() {
    $('.gallery-{{ id }}').magnificPopup({
      type: 'image',
      key: 1, // because they all use the same layout, this reuses the html so it doesnt have to be recreated,
      preload: [1,3], // preload one previous image and three next images
      gallery: {
        enabled: true
      },
      items: [{% for photo in photos %}
        {
          src: {{ photo.safe_large_image.url|escapejson }},
          title: $("<div/>").html({{ photo.full_caption|escapejson }})
        },{% endfor %}
      ]
    });
  });
</script>
{% endaddtoblock %}
{% endif %}
{% endwith %}
