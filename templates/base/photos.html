{% load thumbnail %}
{% load static from staticfiles %}
{% load sekizai_tags %}
{% load humanize %}

{% if photos %}
  {% with id=id|default:"1" %}
    <div class="gallery" id="{{ id }}">
      {% with image=photos|first %}
        {% thumbnail image.image "682" as im %}
          <img src="{{ im.url }}" alt={{ image.title }}/></p>
        {% endthumbnail %}
      {% endwith %}
    {% addtoblock "js" %}
    <script type="text/javascript">
      CANADA.Gallery[{{ id }}] = [
        {% for image in photos %}
        {% thumbnail image.image "x800" as thumb %}
        {
          sizes: {
            thumb: {
              url:    "{{ thumb.url|escapejs }}",
              width:  {{ thumb.width|escapejs }},
              height: {{ thumb.height|escapejs }},
            },
            large: {
              url:    "{{ image.image.url|escapejs }}",
              width:  {{ image.image.width|escapejs }},
              height: {{ image.image.height|escapejs }}
            }
          },
          title: "{{ image.title|escapejs }}",
          caption: "{{ image.caption|escapejs }}"
        {% if forloop.last %}
        }
        {% else %}
        },
        {% endif %}
        {% endthumbnail %}
        {% endfor %}
      ];
    </script>
    {% endaddtoblock %}
   </div>
 {% endwith %}
{% endif %}
