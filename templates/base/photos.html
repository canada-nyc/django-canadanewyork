{% load imagekit %}
{% load static from staticfiles %}
{% load sekizai_tags %}

{% if photos %}
{% with first_photo=photos|first %}
  <div class="gallery" id="{{ id }}">
    {% thumbnail "x600" first_photo.image %}
  {% addtoblock "js" %}
  <script type="text/javascript">
    {% if id == None %}
    console.error("The photos template with the first image {{ first_photo.id }} ({{ first_photo.title }}) MUST be passed the id of the owning model.");
    {% endif %}
    CANADA.store.load('gallery', {
      id: "{{ id }}",
      photos: [
      {% for photo in photos %}
        {
          id: "{{ photo.id }}",
          sizes: {
            {% thumbnail "x600" photo.image as thumb %}
            thumb: {
              url:    "{{ thumb.url|escapejs }}",
              width:  "{{ thumb.width|escapejs }}",
              height: "{{ thumb.height|escapejs }}",
            },
            {% thumbnail "x800" photo.image as large %}
            large: {
              url:    "{{ large.url|escapejs }}",
              width:  "{{ large.width|escapejs }}",
              height: "{{ large.height|escapejs }}"
            }
          },
          title: "{{ photo.title|escapejs }}",
          caption: "{{ photo.caption|escapejs }}"
        {% if forloop.last %}
        }
        {% else %}
        },
        {% endif %}
        {% endfor %}
      ]
    });
  </script>
  {% endaddtoblock %}
  </div>
  <br>
{% endwith %}
{% endif %}
