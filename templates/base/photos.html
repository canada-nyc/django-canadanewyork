{% load thumbnail %}
{% load static from staticfiles %}
{% load sekizai_tags %}
{% load markdown_deux_tags %}
{% load humanize %}

{% if photos %}
  {% addtoblock "js" %}
    <!-- Add mousewheel plugin (this is optional) -->
    <script src="{% static "canada/fancybox/lib/jquery.mousewheel-3.0.6.pack.js" %}"></script>

    <!-- Add fancyBox -->
    <script src="{% static "canada/fancybox/source/jquery.fancybox.pack.js" %}"></script>

    <!-- Optionally add helpers - button, thumbnail and/or media -->
    <script src="{% static "canada/fancybox/source/helpers/jquery.fancybox-buttons.js" %}"></script>
    <script src="{% static "canada/fancybox/source/helpers/jquery.fancybox-media.js" %}"></script>
    <script src="{% static "canada/fancybox/source/helpers/jquery.fancybox-thumbs.js" %}"></script>

  {% endaddtoblock %}
  {% addtoblock "css_no_compress" %}
    <!-- Add fancyBox -->
    <link rel="stylesheet" href="{% static "canada/fancybox/source/jquery.fancybox.css" %}"  media="screen" />

    <!-- Optionally add helpers - button, thumbnail and/or media -->
    <link rel="stylesheet" href="{% static "canada/fancybox/source/helpers/jquery.fancybox-buttons.css" %}"  media="screen" />
  {% endaddtoblock %}

  {% with id=id|default:"1" %}
    {% with image=photos|first %}
      {% thumbnail image.image "x400" as im %}
      <figure>
        <a class="open_fancybox{{ id }}" href="{{ im.url }}">
            <img src="{{ im.url }}" alt={{ image.title }}/>
        {% if not photos|length_is:"1" %}
          <figcaption>
            Click for {{ photos|length|add:"-1"|apnumber }} more photo{{ photos|length|add:"-1"|pluralize }}
          </figcaption>
        {% endif %}
        </a>
      </figure>
      {% endthumbnail %}
    {% endwith %}

    {% addtoblock "js_no_compress" %}
    <script type="text/javascript">
    $(".open_fancybox{{ id }}").click(function() {
        $.fancybox.open(
          [
            {% for image in photos %}
              {% thumbnail image.image "x800" as im %}
              {
                href : '{{ im.url|escapejs }}',
                title : '<p>{{ image.title|escapejs }}</p>{{ image.caption|escapejs }}'
              },
              {% endthumbnail %}
            {% endfor %}
          ],
          {
            padding : 0,
            margin : [20, 120, 20, 120], // Increase left/right margin
            aspectRatio: true,
            helpers : {
              title: {
                type: 'outside'
              },
              overlay : {
                css : {
                  'background' : 'black'
                }
              }
            }
          }
        );
        return false;
      });
    </script>
    {% endaddtoblock %}
 {% endwith %}
{% endif %}
