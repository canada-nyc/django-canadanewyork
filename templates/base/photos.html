{% load thumbnail %}
{% load static from staticfiles %}
{% load sekizai_tags %}
{% load markdown_deux_tags %}

{% if photos %}
  {% with id=id|default:"1" height=image_size|cut:"x" %}
    {% for image in photos %}
      {% thumbnail image.image image_size as im %}
      <a class="fancybox" data-title-id="{{ image.pk }}" href="{{ im.url }}" rel="{{ id }}"><img src="{{ im.url }}"/></a>
      <div id="{{ image.pk }}" class="hidden">
          <strong>{{ image.title }}</strong> {{ image.caption|markdown }}
      </div>
      {% endthumbnail %}
    {% endfor %}

    {% addtoblock "js" %}
      <!-- Add mousewheel plugin (this is optional) -->
      <script src="{% static "canada/fancybox/lib/jquery.mousewheel-3.0.6.pack.js" %}"></script>

      <!-- Add fancyBox -->
      <script src="{% static "canada/fancybox/source/jquery.fancybox.pack.js?v=2.1.3" %}"></script>

      <!-- Optionally add helpers - button, thumbnail and/or media -->
      <script src="{% static "canada/fancybox/source/helpers/jquery.fancybox-buttons.js?v=1.0.5" %}"></script>
      <script src="{% static "canada/fancybox/source/helpers/jquery.fancybox-media.js?v=1.0.5" %}"></script>
      <script src="{% static "canada/fancybox/source/helpers/jquery.fancybox-thumbs.js?v=1.0.7" %}"></script>

    {% endaddtoblock %}
    {% addtoblock "css_no_compress" %}
      <!-- Add fancyBox -->
      <link rel="stylesheet" href="{% static "canada/fancybox/source/jquery.fancybox.css?v=2.1.3" %}"  media="screen" />

      <!-- Optionally add helpers - button, thumbnail and/or media -->
      <link rel="stylesheet" href="{% static "canada/fancybox/source/helpers/jquery.fancybox-buttons.css?v=1.0.5" %}"  media="screen" />
      <link rel="stylesheet" href="{% static "canada/fancybox/source/helpers/jquery.fancybox-thumbs.css?v=1.0.7" %}"  media="screen" />
    {% endaddtoblock %}
      <script>
        var data = [
          {% for image in photos %}
            {% thumbnail image.image image_size as im %}
            {
              image: '{{ im.url|safe }}',
              title: '{{ image.title }}',
              description: '{{ image.caption|markdown }}',
            }{% if not forloop.last %},{% endif %}
            {% endthumbnail %}
          {% endfor %}
        ];
        Galleria.run('#galleria{{ id }}', {
          dataSource: data
        });
      </script>
    {% endaddtoblock %}
    {% addtoblock "js" %}
    <script>
      Galleria.configure({
        thumbnails: false,
        _toggleInfo: false,
        height: {{ height }},
        layerFollow: true,
      });
    </script>
    {% endaddtoblock %}
    {% addtoblock "css" %}
      <style type="text/css">
        #galleria{{ id }} {height:{{ height }}}
      </style>
    {% endaddtoblock %}
 {% endwith %}
{% endif %}
